[!
   use XML::LibXML;
   use XML::LibXSLT;
!]
[-
-]
[$ sub question_info $]
  [- $q = shift;
     $eval_id = shift; 
     $eval_editable = shift;
     $editable = !$q->has_been_answered($eval_id);
     $type = $q->body()->question_type(); -]
<tr bgcolor="#ccccff"><td align="center"><a name="q_[+ $q->primary_key() +]"><span class="title">[+ $q->get_real_label() ? $q->get_real_label() : "-" +]</span></td>
<td align="left"><span class="title">ID: [+ $q->primary_key() +] Type: [+ $type +]
[$ if $q->body()->is_reference() $] (Reference)[$ endif $]</span> 
[# question_type_select($q->primary_key(), $type) #]
</td></tr>

<tr><td align="center">Sort: [+ $q->sort_order() +]</td>
<td align="left">
<table border="0" width="100%" cellpadding="2" cellspacing="0">
<tr>
  <td align="right"><b>Required:</b></td>
  <td align="left">[+ $q->is_required() ? "Yes" : "No" +]</td>
  <td align="right"><b>N/A Available:</b></td>
  <td align="left">[+ $q->body()->na_available() ? "Yes" : "No" +]</td>
  <td align="right"><b>Grouping:</b></td>
  <td align="left">
    [+ $q->group_by_ids() ? join(', ', $q->group_by_ids()) : 'None' +]
  </td>
</tr>
</table>
</td></tr>

<tr>
<td rowspan="2" valign="top" align="left">
[$ if (($type ne 'Title' && $type ne 'Instruction') || $eval_editable) $]
	[$ if $editable $]
		[$ if not $q->other_evals_answered() $]
			<input type="checkbox" name="edit_q" value="[+ $q->primary_key() +]" />Edit<br />
		[$ else $]
			<input type="checkbox" name="duplicate_q" value="[+ $q->primary_key()+]" />Dup &amp; Edit<br/>
		[$ endif $]
			<input type="checkbox" name="unlink_q" value="[+ $q->primary_key() +]" />Unlink
		[$ else $]
		&nbsp;
	[$ endif $]
[$ endif $]
</td>

<td align="left">
  <div style="font-family: sans-serif; border: solid #ccc; padding: 3pt;">
    [- 
       $parser = XML::LibXML->new();
       $xslt = XML::LibXSLT->new();
       $filename = $ENV{XSL_ROOT} . "/Common/flow.xsl";
       my $style_doc = $parser->parse_file($filename);
       $stylesheet = $xslt->parse_stylesheet($style_doc);
       my $doc = 
         $parser->parse_string($HSDB45::Eval::Question::Body::prolog.$q->body()->elt()->first_child('question_text')->sprint()); 
       $result = $stylesheet->transform($doc);
    -]
    [+ $stylesheet->output_string($result) +]
  </div>
</td></tr>

[- 
  if ($q->body()->is_reference()) {
    question_ref($q);
  }
  elsif ($type eq 'Title' || $type eq 'Instruction') {
    title_instruction($q);
  }
  elsif ($type eq 'MultipleChoice' || $type eq 'MultipleResponse' || $type eq 'DiscreteNumeric') {
    multiple_choice_response($q);
  }
  elsif ($type eq 'NumericRating' || $type eq 'PlusMinusRating') {
    numeric_rating($q);
  }
  elsif ($type eq 'Count') {
    count($q);
  }
  elsif ($type eq 'Ranking') {
    ranking($q);
  }
  elsif ($type eq 'TeachingSite') {
    teaching_site($q);
  }
  elsif ($type eq 'SmallGroupsInstructor') {
    small_groups_instructor($q);
  }
  elsif ($type eq 'IdentifySelf') {
    identify_self($q);
  }
  elsif ($type eq 'FillIn' || $type eq 'NumericFillIn') {
    fill_in($q);
  }
  else {
    title_instruction($q);
  }
-]
[$ endsub $]

[$ sub question_type_select $]
[- ($eval_editable) = @_; -]
  <select name="new_q_type">
  [$ foreach $qtype HSDB45::Eval::Question::Body->question_types() $]
	[$ if ($eval_editable) || (($qtype ne 'Instruction') && ($qtype ne 'Title')) $]
	  <option value="[+ $qtype +]">[+ $qtype +]</option>
	[$endif$]
  [$ endforeach $]
  </select>
[$ endsub $]

[$ sub title_instruction $]
  [- ($q) = shift; -]
  <!-- Title/Instruction More Information -->
  <tr><td></td></tr>
[$ endsub $]

[$ sub count $]
  [- ($q) = shift; -]
  <!-- Count More Information -->
  <tr><td>
    <table cellpadding="0" cellspacing="2" border="0" width="100%">
    <tr><td width="25%" align="right"><b>Style:</b></td>
        <td width="25%" align="left">[+ $q->body()->choice_style() +]</td>
        <td width="25%" align="right"><b>Low Bound:</b></td>
        <td width="25%" align="left">[+ $q->body()->low_bound() +]
        [+ $q->body->lower_than_bound() ? " (with lower)" : "" +]</td></tr>
    <tr><td align="right"><b>Align:</b></td>
        <td align="left">[+ $q->body()->choice_align()  +]</td>
        <td align="right"><b>Interval:</b></td>
        <td align="left">[+ $q->body()->interval() +]</td></tr>
    <tr><td align="right"></td>
        <td align="left"></td>
        <td align="right"><b>High Bound:</b></td>
        <td align="left">[+ $q->body()->high_bound() +]
        [+ $q->body->higher_than_bound() ? " (with higher)" : "" +]</td></tr>
    </table>
  </td></tr>
[$ endsub $]

[$ sub multiple_choice_response $]
  [- ($q) = shift; -]
  <tr><td align="left">
  <b>Choice Columns</b>: [+ $q->body()->num_columns() || 'Unspecified' +]<br />
  <b>Choices</b>
  <ol style="margin-top: 0pt" type="a">
    [$ foreach $choice ($q->body()->choices()) $]
    <li>[+ $choice +]</li>
    [$ endforeach $]
  </ol>
  </td></tr>
[$ endsub $]

[$ sub numeric_rating $]
  [- ($q) = shift; -]
  <!-- Numeric Rating More Information -->
  <tr><td align="left">
    <table cellpadding="0" cellspacing="2" border="0" width="100%">
    <tr><td width="25%" align="right"><b>Num Steps:</b></td>
        <td width="25%" align="left">[+ $q->body()->num_steps() +]</td>
        <td width="25%" align="right"><b>Low Text:</b></td>
        <td width="25%" align="left">[+ $q->body()->low_text() +]</td></tr>
    <tr><td align="right"><b>Style:</b></td>
        <td align="left">[+ $q->body()->choice_style() +]</td>
        <td align="right"><b>Mid Text:</b></td>
        <td align="left">[+ $q->body()->mid_text() +]</td></tr>
    <tr><td align="right"><b>Show numbers:</b></td>
        <td align="left">[+ $q->body()->show_numbers() ? 'Yes' : 'No'  +]</td>
        <td align="right"><b>High Text:</b></td>
        <td align="left">[+ $q->body()->high_text() +]</td></tr>
    </table>
  </td></tr>
[$ endsub $]

[$ sub fill_in $]
  [- ($q) = shift; -]
  <!-- Fill-in More Information -->
  <tr><td align="left"><b>Long Text:</b> [+ $q->body()->longtext() ? "Yes" : "No" +]</td></tr>
[$ endsub $]

[$ sub identify_self $]
  [- ($q) = shift; -]
  <!-- Identify Self More Information -->
  <tr><td></td></tr>
[$ endsub $]

[$ sub small_groups_instructor $]
  <tr><td align="left">Small groups instructor info here.</td></tr>
[$ endsub $]

[$ sub teaching_site $]
  [- $q = shift(); -]
  <tr>
    <td>
      <ul>
      [$ foreach $ts ($q->parent_eval()->course()->child_teaching_sites()) $]
        <li>[+ $ts->site_name() +]</li>
      [$ endforeach $]
      </ul>
    </td>
  </tr>
[$ endsub $]

[$ sub question_ref $]
  [- $q = shift(); -]
  [- $tid = $q->body()->target_question_id(); -]
  <tr><td align="left">Reference to <a href="#q_[+ $tid +]">Question [+ $tid +]</a></td></tr>
[$ endsub $]
