[! use Apache::Constants qw(:common); !]
[- 
    $user_id = $req_rec->connection->user;
    $user = HSDB4::SQLRow::User->new->lookup_key($user_id);
    unless ($user->primary_key) {
        $req_rec->status (NOT_FOUND);
        exit;
    }
    @g = $user->parent_user_groups;

    $escmode=0;
    $embperldir = $req_rec->server_root_relative($ENV{EMBPERL_LIB});
    Execute ({inputfile => "$embperldir/hsdblib.html", import => 1});
-]
<HTML>
<HEAD>
<TITLE>HSDB Groups Display: [+$user->out_abbrev+]</TITLE>
[- Execute ("$embperldir/hsdb4-style.css"); -]
</HEAD>
<BODY>
[- head_graphics ($user->out_abbrev . " Groups Display") -]

[$ if @g > 1 $]
[$ sub sect_link $]
[- $ing = shift; -]
<A HREF="#sec_id_[+$ing->primary_key+]">[+$ing->out_label+]</A>
[$ endsub $]

<UL>
<LI>[$ if $g[$row] $][- sect_link($g[$row]) -][$endif$]
</UL>
[$ endif $]

[$ foreach $group @g $]

<H3 CLASS="title"><A NAME="sec_id_[+$group->primary_key+]">[+$group->out_label+]</A></H3>

[- @courses = $group->current_courses -]
[$ if @courses $]
<H4 CLASS="title">Current Courses</H4>
<UL>
<LI>[+$courses[$row] && $courses[$row]->out_html_label()+]
</UL>
[$ endif $]

[- @users = sort { $a cmp $b } $group->child_users() -]
[$ if @users $]
<H4 CLASS="title">Users</H4>
[- $maxcol = 4 -]
<TABLE>
<TR><TD>[+$users[$cnt] && $users[$cnt]->out_html_label()+]</TD></TR>
</TABLE>
[$ endif $]

[$ endforeach $]
</BODY>
</HTML>