[!
    use HSDB4::SQLRow::PPTUpload;
    use HSDB4::Constants;
    use TUSK::Session;
!][-

   $req = shift;

   # page setup
   $req->{checkforadmin} = 1;
   $req->{checkforevaladmin} = 1;

   $req->{include_dir} = $req_rec->server_root_relative($ENV{EMBPERL_LIB});
   $req->{pagetitle}= "Manage Content";
   $req->{nostandardheader} = 1;

   # call the include files
   Execute($req->{include_dir}."/manage/master");
   Execute({inputfile=>$req->{include_dir}."/prepend.html",import=>1});
   
   if (TUSK::Session::is_admin(\%udat) or TUSK::Session::is_eval_admin(\%udat)){
      $req->{leftnav}="admin-leftnav";
   }

   # Fetch user's editable courses...
   $courses_hashref=TUSK::Session::cms_user_courses($req->{user});

    foreach $school (keys %{$courses_hashref}){
	    foreach $course (sort keys %{$courses_hashref->{$school}}){
		    if($courses_hashref->{$school}->{$course}->type() ){
		         if($courses_hashref->{$school}->{$course}->type() eq 'group'){
			        $group_courses_hashref->{$school}->{$course} = $courses_hashref->{$school}->{$course};
				    delete $courses_hashref->{$school}->{$course};
			    }
			    elsif($courses_hashref->{$school}->{$course}->type() eq 'thesis committee'){
			        $tc_courses_hashref->{$school}->{$course} = $courses_hashref->{$school}->{$course};
				    delete $courses_hashref->{$school}->{$course};
			    }
			}
		}
		# if we have deleted all courses from a school above, delete the school, itself
		if(!(keys %{$courses_hashref->{$school}})){
		    delete $courses_hashref->{$school};
		}

	}

   
   # What has been recently modified
   @recently_modified=$req->{user}->recently_modified;

   # Any PPTs we need to know about
   @ppt_statuses = HSDB4::SQLRow::PPTUpload->new->lookup_user_ppt($req->{user}->primary_key);
   
   # call the header
   manage_header($req);
-]
<!-- Begin Manage Content Header Table -->
	<table width="99%" border="0" cellpadding="0" cellspacing="0" background="/graphics/bg-redline.gif"><tr><td  valign="top"><img src="/graphics/header-managecontent.gif" alt="Manage Content" border="0" vspace="5"></td>
	<td width="100%" valign="top"><img src="/graphics/spacer.gif" alt=" " width="20" height="20"></td></tr></table>
<!-- End Manage Content Header Table -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">   
<tr>             

<td width="50%" valign="top" colspan="3">Select a course to manage or add content to:</td>
	<td width="10" valign="top"><img src="/graphics/spacer.gif" alt=" " width="1" height="1" border="0"></td>
                <td width="50%" valign="top">&nbsp;</td>
	<td width="10" valign="top"><img src="/graphics/spacer.gif" alt=" " width="1" height="1" border="0"></td>
  </tr>
   <tr>
    <td width="10" valign="top"><img src="/graphics/spacer.gif" alt=" " width="1" height="1" border="0"></td>
                <td width="50%" valign="top">
[$ foreach $school (keys %{$courses_hashref}) $]
 <table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" valign="top"><h3 class="gRedHeaderBar">[+ $school +] School</h3></td
  </tr>
</table>
<table width="100%" cellspacing="0" cellpadding="0">
[$ foreach $course (sort keys %{$courses_hashref->{$school}}) $]
[-     ($label,$id)=split("\0",$course);      -]
                    <tr> 
                      <td width="90%" class="graycell"><a href="/management/course/display/[+ $school +]/[+ $id +]">[+ $label +]</a></td>
                    </tr>
[$ endforeach $]

</table>
[$ endforeach $]
<br><br>
</td>
	<td width="10" valign="top"><img src="/graphics/spacer.gif" alt=" " width="10" height="1" border="0"></td>
                <td width="50%" valign="top"> 
                  <!-- Begin Quick Edit Header Table -->
                  <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr> 
			<td width="100%" valign="top"><h3 class="gRedHeaderBar">Quick Content Modify</h3></td
                    </tr>
                  </table>
                  <!-- End Quick Edit Header Table -->
                  <!-- Begin Quick Edit Table -->
                  <table width="100%" border="0" cellpadding="0" cellspacing="0">
                    <tr> 
                      <td width="1" valign="top" background="/graphics/bg-reddotsvert.gif"><img src="/graphics/spacer.gif" alt=" " width="1" height="1" border="0"></td>
                      <td width="150%" valign="top"> 
                        <!-- Begin Inner Quick Edit Table -->
                        <table width="100%" border="0" cellspacing="5" cellpadding="0">
                          <tr> 
                            <td width="100%" valign="top" class="cell-left" nowrap><form action="/management/content/addedit/content" name="content" method="post" class="no-padding" onsubmit="return checkform(this);"><input type="hidden" name="page" value="edit">
                                ID#: 
                                <input name="content_id" type="text" class="textareawhite" size="8" id="Content_ID__y">&nbsp;
                                <input name="Find" type="submit" class="formbutton" value="Modify">&nbsp;<a href="javascript:open_window('/manage/search?type=content&parent=opener.document.content.edit_content_id.value','directories=no,menubar=no,toolbar=yes,scrollbars=yes,resizable=yes,width=800,height=700');" class="xxsm">Search for Content IDs</a>
                              </form></td>
                          </tr>
                          <tr> 
                            <td width="100%" valign="top"><img src="/graphics/spacer.gif" alt=" " width="1" height="1" border="0"></td>
                          </tr>
                        </table>
                        <!-- End Inner Quick Edit Table -->
                      </td>
                    </tr>
                  </table>
                  <!-- End Quick Edit Table -->

                  <!-- Begin Recently Modified Header Table -->
                  <table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" valign="top"><h3 class="gRedHeaderBar">Recently Modify</h3></td
  </tr>
</table>
<!-- End Recently Modified Header Table -->
<!-- Begin Recently Modified Table -->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
  <tr>
    <td width="1" valign="top" background="/graphics/bg-reddotsvert.gif"><img src="/graphics/spacer.gif" alt=" " width="1" height="1" border="0"></td>
	<td width="150%" valign="top">
	<!-- Begin Inner Recently Modified Table -->
	<table width="100%" border="0" cellspacing="5" cellpadding="0">
	[$ if (@recently_modified) $]
	[$ foreach $content (@recently_modified) $]
	    <tr>
	       <td width="100%" valign="top" class="cell-left"><a href="/management/content/addedit/course/[+ $content->field_value('school') +]/[+ $content->field_value('course_id') +]/[+ $content->primary_key +]?page=edit">[+ $content->field_value('title') +]</a> ([+ $content->primary_key +])&nbsp;<i>[+ $content->modified_date +]</i></td>
	    </tr>
	[$ endforeach $]
	[$ else $]
	<tr>
	<td class="cell-left">
	     <i>No recently modified content.</i>
	</td>
	</tr>
	[$ endif $]
   <tr>
	<td width="100%" valign="top"><img src="/graphics/spacer.gif" alt=" " width="1" height="1" border="0"></td>
  </tr>
</table>
	<!-- End Inner Recently Modified Table -->
	</td>
  </tr>
</table>
	<!-- End Inner Recently Modified Table -->
<!-- End Recently Modified Table -->


[$ foreach $school (keys %{$group_courses_hashref}) $]
      <!-- Begin My Groups Header Table -->

<h3 class="gRedHeaderBar">[+ $school +] groups [beta]</h3>

      <!-- End My Groups Header Table -->
      <!-- Begin my Groups Table -->
      <table width="100%" border="0" cellpadding="0" cellspacing="0">
       <tr>
        <td width="1" valign="top" background="/graphics/bg-reddotsvert.gif"><img src="/graphics/spacer.gif" alt=" " width="1" height="1" border="0"></td>
	<td width="150%" valign="top">
	<!-- Begin Inner My Groups Table -->
	 <table width="100%" border="0" cellspacing="5" cellpadding="0">
    [$ foreach $g_course (sort keys %{$group_courses_hashref->{$school}}) $]
	    [- ($label,$id)=split("\0",$g_course) -]
		<tr><td width="100%" valign="top" class="cell-left"><a href="/management/course/display/[+ $school +]/[+ $id +]">[+ $label +]</a></td></tr>
	[$ endforeach $]
	  <tr>
	   <td colspan="2" width="100%" valign="top"><img src="/graphics/spacer.gif" alt=" " width="1" height="1" border="0"></td>
          </tr>
         </table>
         <!-- End Inner My Groups Table -->
        </td>
       </tr>
      </table>
      <!-- End My Groups Table -->
[$ endforeach $]


[$ foreach $school (keys %{$tc_courses_hashref}) $]
      <!-- Begin Thesis Committee Header Table -->

<h3 class="gRedHeaderBar">[+ $school +] Thesis Committees [beta]</h3>

      <!-- End Thesis Committee Header Table -->
      <!-- Begin Thesis Committee Table -->
      <table width="100%" border="0" cellpadding="0" cellspacing="0">
       <tr>
        <td width="1" valign="top" background="/graphics/bg-reddotsvert.gif"><img src="/graphics/spacer.gif" alt=" " width="1" height="1" border="0"></td>
	<td width="150%" valign="top">
	<!-- Begin Inner Thesis Committee Table -->
	 <table width="100%" border="0" cellspacing="5" cellpadding="0">
    [$ foreach $tc_course (sort keys %{$tc_courses_hashref->{$school}}) $]
	    [- ($label,$id)=split("\0",$tc_course) -]
		<tr><td width="100%" valign="top" class="cell-left"><a href="/management/course/display/[+ $school +]/[+ $id +]">[+ $label +]</a></td></tr>
	[$ endforeach $]
	  <tr>
	   <td colspan="2" width="100%" valign="top"><img src="/graphics/spacer.gif" alt=" " width="1" height="1" border="0"></td>
          </tr>
         </table>
         <!-- End Inner Thesis Committee Table -->
        </td>
       </tr>
      </table>
      <!-- End Thesis Committee Table -->
[$ endforeach $]


<!-- Begin Conversion Status Header Table -->
	<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
	<td width="100%" valign="top"><h3 class="gRedHeaderBar">Conversion Status</h3></td
  </tr>
</table>
<!-- End Conversion Status Header Table -->
<!-- Begin Conversion Status Table -->
<table width="100%" border="0" cellpadding="0" cellspacing="0">
  <tr>

    <td width="1" valign="top" background="/graphics/bg-reddotsvert.gif"><img src="/graphics/spacer.gif" alt=" " width="1" height="1" border="0"></td>
	<td width="150%" valign="top">
	<!-- Begin Inner Conversion Status Table -->
	<table width="100%" border="0" cellspacing="5" cellpadding="0">
[$ if (@ppt_statuses) $]
[$ foreach $ppt (@ppt_statuses) $]
<tr>
    <td width="100%" valign="top" class="cell-left">[+ $ppt->field_value('title') +] ([+ $ppt->field_value('content_id') +]) <em>- [+ $ppt->field_value('status') +]</em></td>
  </tr>
[$ endforeach $]
[$ else $]
<tr>
   <td class="cell-left"><i>No powerpoint uploads.</i>
   </td>
</tr>
[$endif$] 
   <tr>
	<td width="100%" valign="top"><img src="/graphics/spacer.gif" alt=" " width="1" height="1" border="0"></td>
  </tr>
</table>
	<!-- End Inner Conversion Status Table -->
	</td>
  </tr>
</table>
                  <!-- End Conversion Status Table -->


<table cellspacing="0" cellpadding="0">
<tr>
<td class="cell-left"><br><a href="/manage/myfolders/content">My Folders</a></td>
</tr>
<tr>
<td class="cell-left"><a href="/manage/mycontent" class="cell-left">Search My Content</a></b></p><br><br>
</td>
</tr>
</table>
	</td>
  </tr>
</table>

[- manage_footer(); -]
