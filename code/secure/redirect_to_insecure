<HTML>
<HEAD>
[# OK, this isn't actually an HTML document.  We just use EmbPerl to
do a redirect.  #]

[#	And since we're trying to retire Embperl, this page will send off an error email
	to alert the dev team that it's been called
#]

[! 
use Apache::Constants qw(REDIRECT);
use TUSK::Constants;
use TUSK::ErrorReport;
!]
[-
  $msgBody = ErrorReport::sendErrorReport($req_rec, {'Subject' => 'Embperl redirect_to_insecure called!', 'Msg' => 'Embperl redirect_to_insecure called!'});

  $debug = $req_rec->dir_config('HSDBDebug') || 0;
  $orig_doc = $ENV{'REDIRECT_URL'} || $ENV{'REQUEST_URI'};
  $qs = $ENV{'REDIRECT_QUERY_STRING'} || $ENV{'QUERY_STRING'};;
  $qs = (!length($qs)? "": "?$qs");
  $open_port = 80;
  $open_port = $req_rec->get_server_port - 100 if ($req_rec->get_server_port > 9000);
  $new_doc = "http://" . $req_rec->get_server_name() . ":$open_port$orig_doc$qs";
  $req_rec->warn("Redirecting $orig_doc to $new_doc");

  $req_rec->header_out("Location" => $new_doc );
  $req_rec->status(REDIRECT);
-]
</HEAD><BODY>
Redirecting [+ $orig_doc +] to [+ $new_doc +].
</BODY></HTML>


