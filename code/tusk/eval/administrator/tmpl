<%once>
	use HSDB45::TimePeriod;
	use HSDB45::Course;
</%once>


<%method get_current_time_periods>
<%args>
	%params => ()
</%args>
<%perl>
	my @current_time_periods = HSDB45::TimePeriod->new(_school => $m->comp('SELF:schoolname'))->lookup_all('end_date >= curdate()', 'ORDER BY end_date ASC');
	my @time_periods;

	push @time_periods, { value => '', label => '' };
	foreach (@current_time_periods) {
		push @time_periods, { 
			value  => $_->primary_key(),
			label  => $_->field_value('period') . ', ' 
				. $_->field_value('academic_year') 
				. ' &nbsp;&nbsp; (<span style="font-size:65%;">' 
				. $_->field_value('start_date') . ' to ' 
				. $_->field_value('end_date') 
				. ')</span>' 
		};
	}
</%perl>

<& /tmpl/element:dropdown, params => { 
	label			=> ($params{label}) ? $params{label} : 'Time Period:',
	name			=> 'time_period_id',
	options			=> \@time_periods,
	selected		=> $params{selected},
	onchange		=> $params{onchange},
	trailing_text	=> $params{trailing_text},
} &>
</%method>


<%method get_courses>
<%perl>
	my $school = $m->comp('SELF:schoolname');
	my @all_courses = HSDB45::Course->new(_school => $school)->lookup_all('ORDER BY title');
	my @courses;
	push @courses, { value => '', label => '' };

	foreach (@all_courses) {
		next unless $_->title() =~ /\w+/;
		push @courses, { 
			value  => $_->primary_key(),
			label  => $_->title() . ' (' . $_->primary_key() . ')',
		}
	}
	return \@courses;
</%perl>
</%method>

