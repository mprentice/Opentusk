<%once>
	use TUSK::Import::EnrollListing;
	use TUSK::Constants;
</%once>


<& /tmpl/element:table, params => { 
	width => "100%",
	border =>"0",
	cellspacing =>"0",
	cellpadding =>"0" } &>

<tr><td class="bar"><img src="/icons/transdot.gif" width=1 height=2></td></tr></table>
<form name="data_form" method="post" enctype="multipart/form-data" onsubmit="return checkform(this);" class="no-padding">

<table width="100%" border="0" cellspacing="0">
<tr>
<td class="labelgray">Import type:</td>
<td class="cell-left"><table class="tusk" width="50%"><tr><td>Test<input type="radio" name="save" value="0" checked></td><td align="right">Live<input type="radio" name="save" value="1"></td></tr></table><br>"Test" verifies data, but does not save. "Live" verifies and saves data.</td>
</tr>
% if ($school) {
<input type="hidden" name="school" value="<% $school %>">
<td class="labelgray">School: </td><td class="cell-left"><% $school %></td>
% } else {
<tr>
<td class="labelgray">School:</td><td class="cell-left">
<select name="school">
% foreach my $schl (HSDB4::Constants::course_schools) {
<option value="<% $schl %>"><% $schl %></option>
% }
</select>
</td>
</tr>
% }
<tr>
<td class="labelgray">File:</td><td class="cell-left"><input class="formbutton" type="file" name="datafile" id="File__y"></td>
</tr>
<tr>
<td class="labelgray">Time Period: </td><td class="cell-left"><input class="textareawhite" type="text" name="period" size="30" id="Time_Period__y"><br>Multiple time periods can be separated by comma (ie 01,02)</td>
</tr>
<tr>
<td class="labelgray">Registrar Code: </td><td class="cell-left"><input class="textareawhite" type="text" name="oea_code" size="30"><br>Enter registrar code to process (ie SGN300)</td>
</tr>
<tr>
<td>&nbsp;</td><td class="cell-submit"><input type="submit" value="Process" class="formbutton"></td>
</tr>
</table>
</form>
% foreach my $log (@logs) {
%	 if ($log->get_type =~ /(error)/) {
	<div class="<% $log->get_type %>"><% $log->get_type %>: <% $log->get_message %></div>
%	}
% }
<h4></h4>
% foreach my $log (@logs) {
	<div class="<% $log->get_type %>"><% $log->get_type %>: <% $log->get_message %></div>
% }


<%init>

	my $import;
	my $school = $m->comp("/tmpl/url:get_school");
	my @logs;
	if ($ARGS{datafile}) {
		$import = TUSK::Import::EnrollListing->new($school,$ARGS{period});
		$import->read_filehandle($ARGS{datafile},"\t");
		$import->process_data($TUSK::Constants::DatabaseUsers->{ContentManager}->{readusername}, $TUSK::Constants::DatabaseUsers->{ContentManager}->{readpassword}, $ARGS{oea_code},$ARGS{save});
		@logs = $import->get_logs;
	}
</%init>

<%method title>
% return "Import Enroll Listing";
</%method>

<%method red_header_text>
% return $m->comp("SELF:title");
</%method>

