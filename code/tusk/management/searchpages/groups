<%attr>
	no_check_path => 1
</%attr>
<%once>
	use HSDB45::UserGroup;
	use Data::Dumper;
</%once>


<& /tmpl/element:table, params => { 
	width => "100%",
	cellspacing =>"5",
	cellpadding =>"0" } &>

	<tr>
		<td>
			<b>Group Name: </b>&nbsp;<input type="text" name="search">&nbsp;&nbsp;<input type="submit" name="action" value="Search" class="formbutton">
		</td>
	</tr>
	<tr>
		<td>
			<input type="button" class="formbutton" value="Close window" onclick="window.close()">&nbsp;
		</td>
	</tr>
%	 if ($ARGS{search}) {
	<tr>	
		<td><br>
			<div id="count"><% scalar(@results) %> matching entr<% (scalar(@results) == 1)? "y" : "ies" %><% (scalar(@results))? ":" : "" %></div>
		</td>
	</tr>
%   if (@results) {
	<tr>
		<td>
			<div id="searchdiv"></div>
<%perl>
	foreach my $group (@results){
		my $pk = $group->primary_key();
		push (@resultarray, {group_name => $group->label(), user_group_id => $group->primary_key()});
	}
</%perl>

<& /tmpl/layers:create_layer, struct => {
			layer => 'searchdiv',
			fields => ['group_name','user_group_id'],
			name => '',
			scrollrows => 9,
			parentlayer => $ARGS{parentlayer},
			sort => {usage => 'No'},
			action => {usage => 'Yes', length=>100, functions => [
									{func=>'add', label=>'Add'}
								]},
			display => [
					{field=>'user_group_id', align=>'left', length=>225, type=>'hidden'},
					{field=>'group_name', label=>'Group Name', align=>'left', length=>225,},
				  ],
			validate => {
					usage => 'No',
				},
			data => \@resultarray,			
						}
&>

		</td>

	</tr>
%	}
%	}
</table>

<%init>

    my $search;	
	my @results;
	my @resultarray;
	if ($ARGS{search} && $ARGS{schl}){
		($search = $ARGS{search}) =~ s/'/\\'/g;
		@results = HSDB45::UserGroup->new(_school => $ARGS{schl})->lookup_conditions("label like '\%" . $search . "\%'","order by label");
	}
	
</%init>
