<%args>
</%args>

<%attr>
        top_tab_type            => 'none'
        displayLittleUserNavBar => '1'
        default_path_type       => 'course'
        no_header               => '1'
        page_header             => undef
        page_footer             => undef
        allow_guests            => '0'
</%attr>

<%shared>
        my $iAmAGuest = HSDB4::Constants::is_guest($m->session->{'user'});
	my $document = $m->comp('/tmpl/url:get_type_object');
	my $isMyPasswordValid = 0;
	my $course = $m->comp('/tmpl/url:get_type_object');
	my $events = $m->session->{'user'}->get_course_grades($course);
</%shared>

<%method startup>
	<%args>
		$args => {}
	</%args>
	<%perl>
		$isMyPasswordValid = $m->comp("/tmpl/loginForm:verifyLogin", args=>$args);
	</%perl>
</%method>


% $m->clear_buffer();
% $r->content_type('text/html');
% $r->no_cache(1);
%	if($isMyPasswordValid) {
%		if(scalar(@{$events})) {
			<table border="0" width="100%" class="wide">
				<tr><th align="left">Name</th><th align="left">Grade</th><th align="left">Comments</th></tr>

%			foreach my $event (@{$events}) {
%				my $grade = '';
%				my $link = $event->getJoinObject("TUSK::GradeBook::LinkUserGradeEvent");
%				if(!defined($link)){$grade = 'No Grade'} else {$grade = $link->getGrade();}
					<tr>
						<td class="html_row"><% $event->getEventName() %></td>
						<td class="html_row"><% $grade %></td>
						<td class="html_row"><% $link->getComments() %></td>
					</tr>
%				}
			</table>
%		} else {
		<& '/tmpl/prepend:traffic_light', args => {'errmsg' => 'You do not have any grades for this course!'}, 'make_table' => 1 &>
%		}
%	} else {
		<& '/tmpl/prepend:traffic_light', args => {'errmsg' => 'Unable to validate password!<br>Please try again.'}, 'make_table' => 1 &>
		<& '/tmpl/loginForm:redisplayPrivateLogin' &>
%	}
